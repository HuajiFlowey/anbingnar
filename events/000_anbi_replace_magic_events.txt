namespace = magic_ruler

#覆盖选举
country_event = {
	id = 701
	title = "EVTNAME700"
	desc = {	#Yinquan
		trigger = { OR = { has_country_flag = holi_retirement_2 has_country_flag = holi_retirement_6 has_country_flag = holi_retirement_7 } }
		desc = "EVTDESC701RETIREMENT"
	}
	desc = {	#Normal
		trigger = { always = yes }
		desc = "EVTDESC701"
	}
	picture = ELECTION_REPUBLICAN_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_states_general_mechanic = yes }
		NOT = { has_government_attribute = lottery_election }
		NOT = { has_government_attribute = is_pirate_republic_reform }
		NOT = { has_reform = military_dictatorship_reform }
		NOT = { has_reform = admiralty_reform }
		# NOT = { has_reform = prussian_republic_reform }
		NOT = { has_reform = black_demesne_reform }
		NOT = { has_reform = black_acolyte_reform }
		NOT = { has_reform = medasi_reform }
		# NOT = { has_disaster =  bonfire_of_the_vanities_disaster }
		NOT = { has_country_modifier = just_had_revolution_bringing_someone_to_power_timer }
		if = {
			limit = {
				has_reform = junior_revolutionary_republic_reform
				has_country_flag = caretaker_revolutionary_government
			}
			republican_tradition = 50
		}
		
		
		#Anbennar
		NOT = { has_reform = anbi_kuhai_united_yanshen }
		NOT = { has_reform = obsidian_council_reform }
		#NOT = { has_country_flag = lich_ruler }
		NOT = { has_reform = roilsard_elective }
		NOT = { has_reform = ar_callein_reform }
		NOT = { has_reform = reuyeli_republic }
		# NOT = { has_reform = original_castanor_trials_reform }
		NOT = { has_reform = krak_clan_council }
		NOT = { has_reform = krak_free_council }
		NOT = { has_reform = eternal_council }
		NOT = { has_reform = sunrise_court_reform }
		NOT = { AND = { tag = Y86 has_ruler_flag = is_hiderion } }
		NOT = { has_reform = sinistral_republic_reform }
		NOT = { has_reform = bulwar_twelve_families_reform }
		NOT = { has_reform = golden_republic_reform }
		NOT = { has_reform = krakazol_olzonog }
		NOT = { has_reform = varamhar_eternal_empire }
		NOT = { has_reform = varamhar_eternal_empire_mandate }
		NOT = { has_reform = trollsbayer_pluralism_reform }
		NOT = { has_reform = dakinshi_warlord_reform }
		NOT = {	has_country_flag = g27_drozmasrecat_flag }
		NOT = { has_reform = besolaki_chaotic_republicanism }
		NOT = {	#From Bulwar MT
			AND = {
				tag = F24
				has_country_flag = bulwar_got_rabsukalukaturanised
			}
		}
		NOT = { has_reform = newshire_stewardship }
		NOT = { has_reform = newshire_high_stewardship }
		NOT = { has_reform = land_of_thousand_shrines}
		NOT = { has_reform = bulwari_temple_reform }
		NOT = { has_reform = mountainshark_govzenszel }
		OR = { NOT = { has_ruler_flag = is_holi } has_country_flag = Y26_election_loop }
		NOT = { has_reform = pentapandemonium_reform }
		NOT = { has_reform = brelar_ynnic_dynastic_republic }
		NOT = { AND = { tag = U04 OR = { has_country_modifier = aakheta_uprising_modifier has_country_modifier = aakheta_uprising_modifier_ai } } }
		NOT = { has_government_attribute = generals_become_rulers }
		NOT = { has_reform = shadow_horde }
		NOT = { has_reform = haraf_kinah_conclave }
		NOT = { has_reform = husziens_council }
		NOT = { has_reform = kai_republic }
		NOT = { has_reform = free_slave_reform }
		NOT = { has_reform = praxic_meritocracy_reform }
		NOT = { has_reform = united_federation }
		NOT = { has_reform = isagumze_scaled_lords_reform }
		NOT = { has_reform = vels_bacar_bacaran_republic }
		NOT = { has_reform = technocracy_republic_reform }
		NOT = { has_reform = imperial_technocracy_republic_reform }
		NOT = { has_country_modifier = thirabnir_stayin_alive } #I wish I wasn't forced to do this, but life extension doesn't work
		NOT = { has_reform = racial_tolerance_reform }
		NOT = { has_reform = abyssal_otardom_reform }
		NOT = { has_reform = forge_council_reform }
		NOT = { has_reform = ameion_republic }
		NOT = { has_reform = exemplar_state }
		NOT = { has_ruler_flag = is_huangke }
		NOT = { has_reform = anbi_kuhai_twin_republic }
		is_mteibhar_parliament = no
	}

	immediate = {
		hidden_effect = {
			pre_select_possible_ruler_focus = yes
		}
	}
	after = {
		post_ruler_focus_clearance = yes
		holi_retirement_flag_clearance = yes #Yinquan
	}
	# #New Anbennar one for liches
	option = {
		name = "magic_project_lichdom.12.c"	# Current ruler stays
		trigger = {
			ruler_can_revive = yes
		}
		ai_chance = { 
			factor = 1000	
		}
		custom_tooltip = remains_ruler

		add_scaled_republican_tradition = -20
		add_karma = -5
		
		revival_stat_loss = yes
	}
	
	option = {
		name = "EVTOPTB700"	# An administrator type
		ai_chance = { factor = 40 }
		if = {
			limit = { has_country_modifier = harpy_administration }
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1				
				female = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { culture_group = dwarven }
			dwarovar_republic_generic_election_effect = {
				mil = 1
				adm = 4
				dip = 1
			}
		}
		else_if = {
			limit = { has_government_attribute = tanizu_elections }
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1
				random_gender = yes
			}
		}
		else_if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
			}
		}
		if = {
			limit = { has_government_attribute = elections_increase_factions_influence }
			add_influence_to_adm_faction = {
				influence = 20
			}
		}
		if = {
			limit = { has_government_attribute = elections_influence_estates }
			add_estate_loyalty_by_class_adm = {
				loyalty = 10
			}
		}
		if = {
			limit = { has_government_attribute = has_candidate_bonus }
			assign_ruler_focus = {
				type = adm
			}
		}
	}
	option = {
		name = "EVTOPTC700"	# A diplomat
		ai_chance = { factor = 30 }
		if = {
			limit = { has_country_modifier = harpy_administration }
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
				female = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { culture_group = dwarven }
			dwarovar_republic_generic_election_effect = {
				dip = 4
				adm = 1
				mil = 1
			}
		}
		else_if = {
			limit = { has_government_attribute = tanizu_elections }
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1
				random_gender = yes
			}
		}
		else_if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				dip = 4
				adm = 1
				mil = 1					
			}
		}
		if = {
			limit = { has_government_attribute = elections_increase_factions_influence }
			add_influence_to_dip_faction = {
				influence = 20
			}
		}
		if = {
			limit = { has_government_attribute = elections_influence_estates }
			add_estate_loyalty_by_class_dip = {
				loyalty = 10
			}
		}
		if = {
			limit = { has_government_attribute = has_candidate_bonus }
			assign_ruler_focus = {
				type = dip
			}
		}
	}
	option = {
		name = "EVTOPTD700"	# A military man
		ai_chance = { factor = 30 }
		if = {
			limit = { has_country_modifier = harpy_administration }
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1	
				female = yes # Makes harpies always have female ruler
			}
		}
		else_if = {
			limit = { culture_group = dwarven }
			dwarovar_republic_generic_election_effect = {
				mil = 4
				adm = 1
				dip = 1
			}
		}
		else_if = {
			limit = { has_government_attribute = tanizu_elections }
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1
				random_gender = yes
			}
		}
		else_if = {
			limit = { republic_with_female_rulers_trigger = yes }
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
				random_gender = yes # Allows random gender for republics
			}
		}
		else = {
			define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
			}
		}
		if = {
			limit = { has_government_attribute = elections_increase_factions_influence }
			add_influence_to_mil_faction = {
				influence = 20
			}
		}	
		if = {
			limit = { has_government_attribute = elections_influence_estates }
			add_estate_loyalty_by_class_mil = {
				loyalty = 10
			}
		}
		if = {
			limit = { has_government_attribute = has_candidate_bonus }
			assign_ruler_focus = {
				type = mil
			}
		}
	}
	option = { # Nepotism choice, re-electing within dynasty
		name = "EVTOPTE700"
		trigger = {
			has_government_attribute = enables_nepotism
		}
		ai_chance = { factor = 10 }
		if = {
			limit = {
				has_country_flag = strengthened_signoria_flag
			}
			custom_tooltip = strengthened_signoria_election_tt
			clr_country_flag = strengthened_signoria_flag
		}
		else = {
			add_scaled_republican_tradition = -4
		}
		if = {
			limit = { 
				has_country_modifier = harpy_administration
				NOT = { has_reform = signoria_reform }
			}
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
				female = yes # Makes harpies always have female ruler
			}
		}
		else_if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				NOT = { has_reform = signoria_reform }
			}
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { 
				has_country_modifier = harpy_administration
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				female = yes # Makes harpies always have female ruler
			}
		}
		else_if = {
			limit = { 
				republic_with_female_rulers_trigger = yes
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { 
				has_reform = signoria_reform
			}
			define_ruler = {
				min_age = 30
				max_age = 50
				name = "lastname"
				random_gender = yes # Allows random gender for republics
			}
		}
		else_if = {
			limit = { culture_group = dwarven }
			if = {
				limit = { has_reform = dwarovar_new_minds } 
				define_ruler = {
					change_mil = -2
					change_adm = -2
					change_dip = -2
					min_age = 50
					max_age = 70
				}
				if = {
					limit = { has_government_attribute = dwarovar_new_minds_effect }
					random_list = {
						20 = {
							trigger = { has_estate = estate_church }
							add_estate_loyalty = { estate = estate_church loyalty = 5 }
						}
						20 = {
							trigger = { has_estate = estate_nobles }
							add_estate_loyalty = { estate = estate_nobles loyalty = 5 }
						}
						20 = {
							trigger = { has_estate = estate_burghers }
							add_estate_loyalty = { estate = estate_burghers loyalty = 5 }
						}
						20 = {
							trigger = { has_estate = estate_mages }
							add_estate_loyalty = { estate = estate_mages loyalty = 5 }
						}
						20 = {
							trigger = { has_estate = estate_artificers }
							add_estate_loyalty = { estate = estate_artificers loyalty = 5 }
						}
						#no adventurers
					}
				}
			}
			else_if = {
				limit = { has_reform = dwarovar_elder_wisdom } 
				define_ruler = {
					change_mil = -2
					change_adm = -2
					change_dip = -2
					min_age = 70
					max_age = 90
					name = "lastname"
				}
			}
			else = {
				define_ruler = {
					change_mil = -2
					change_adm = -2
					change_dip = -2
					min_age = 60
					max_age = 80
					name = "lastname"
				}
			}
		}
		else_if = {
			limit = { has_government_attribute = tanizu_elections }
			define_ruler = {
				change_mil = -2
					change_adm = -2
					change_dip = -2
					min_age = 60
					max_age = 80
					name = "lastname"
				random_gender = yes
			}
		}
		else = {
			define_ruler = {
				change_mil = -2
				change_adm = -2
				change_dip = -2
				min_age = 30
				max_age = 50
				name = "lastname"
			}
		}
		if = {
			limit = { 
				has_faction = mr_aristocrats 
			}
			add_faction_influence = {
				faction = mr_aristocrats
				influence = 10
			}				
		}
		if = {
			limit = { has_government_attribute = elections_influence_estates }
			add_estate_loyalty = {
				estate = all
				loyalty = 10
			}
		}
		if = {
			limit = { has_government_attribute = has_candidate_bonus }
			assign_ruler_focus = {
				type = rng
			}
		}
	}
	option = { # Epednar Option
		name = "EVTOPTF700"
		trigger = { has_government_attribute = epednar_election }
		ai_chance = { factor = 10 }

		define_ruler = {
			adm = 0
			dip = 2
			mil = 3
			culture = epednar
		}
	}
	option = { # Ravelian Option
		name = "EVTOPTG700"
		trigger = { has_government_attribute = ravelian_election }
		ai_chance = { factor = 10 }

		define_ruler = {
			adm = 5
			dip = 1
			mil = 0
			religion = ravelian
		}
		random_list = {
			25 = { add_ruler_personality = zealot_personality }
			25 = { add_ruler_personality = scholar_personality }
			50 = { }
		}
	}
	option = { # Vanbury Candidate
		trigger = { 
		    AND = {
		         has_government_attribute = metropolis_election
				 tag = G97
				 }
			}
		add_scaled_republican_tradition = -4
		add_prestige = 5
		name = "EVTOPTH700"
		ai_chance = { factor = 10 }

		define_ruler = {
			change_mil = 1
			change_adm = -2
			change_dip = -1
			min_age = 30
			max_age = 50
			dynasty = "of Vanbury"
		}
		random_list = {
			20 = { add_ruler_personality = well_connected_personality }
			20 = { add_ruler_personality = industrious_personality }
			20 = { add_ruler_personality = embezzler_personality }
			20 = { add_ruler_personality = greedy_personality }
			20 = { }
		}
	}
	option = { # Silcalas Candidate 
		trigger = { 
		    AND = {
		         has_government_attribute = metropolis_election
				 tag = G98
				 }
			}
		add_scaled_republican_tradition = -4
		add_prestige = 5
		name = "EVTOPTJ700"
		ai_chance = { factor = 10 }

		define_ruler = {
			change_mil = -2
			change_adm = 1
			change_dip = -1
			min_age = 30
			max_age = 50
			dynasty = "Silcalas"
		}
		random_list = {
			20 = { add_ruler_personality = well_connected_personality }
			20 = { add_ruler_personality = architectural_visionary_personality }
			20 = { add_ruler_personality = embezzler_personality }
			20 = { add_ruler_personality = obsessive_perfectionist_personality }
			20 = { }
		}
		}
		#silver republic stuff
	option = { #Ekha 
		name = "EVTOPTK700"
		trigger = { has_reform = reformed_silver_council_reform }
		define_ruler = {
				mil = 1
				adm = 4
				dip = 1					
				random_gender = yes # Allows random gender for republics
		}
		set_ruler_flag = is_from_ekha
		402 = {
			add_province_modifier = {
				name = silver_touched_province
				duration = 2920
			}
		}
	}
	option = { #Khasa  
		name = "EVTOPTL700"
		trigger = { has_reform = reformed_silver_council_reform }
		define_ruler = {
				mil = 1
				adm = 1
				dip = 4					
				random_gender = yes # Allows random gender for republics
				culture = khasani
		}
		set_ruler_flag = is_from_khasa 
		400 = {
			add_province_modifier = {
				name = silver_touched_province
				duration = 2920
			}
		}
	}
	option = { #Deshak   
		name = "EVTOPTM700"
		trigger = { has_reform = reformed_silver_council_reform }
		define_ruler = {
				mil = 4
				adm = 1
				dip = 1					
				random_gender = yes # Allows random gender for republics
				culture = desha
		}
		set_ruler_flag = is_from_deshak  
		382 = {
			add_province_modifier = {
				name = silver_touched_province
				duration = 2920
			}
		}
	}
	option = { #Sigilan    
		name = "EVTOPTN700"
		trigger = { 
			has_reform = reformed_silver_council_reform 
			5813 = { owned_by = ROOT }
		}
		random_list = {
			14 = {
				define_ruler = {
					mil = 2
					adm = 1
					dip = 4					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			14 = {
				define_ruler = {
					mil = 1
					adm = 2
					dip = 4					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			15 = {
				define_ruler = {
					mil = 2
					adm = 4
					dip = 1					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			15 = {
				define_ruler = {
					mil = 1
					adm = 4
					dip = 2				
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			14 = {
				define_ruler = {
					mil = 1
					adm = 2
					dip = 4					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			14 = {
				define_ruler = {
					mil = 4
					adm = 2
					dip = 1					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
			14 = {
				define_ruler = {
					mil = 4
					adm = 1
					dip = 2					
					random_gender = yes # Allows random gender for republics
					culture = binwarji
					religion = fangaulan_pantheon
				}
			}
		}
		set_ruler_flag = is_from_sigilan   
		5813 = {
			add_province_modifier = {
				name = silver_touched_province
				duration = 2920
			}
		}
	}
}

##覆盖施法
#Enchantment - Menu
country_event = {
	id = magic_ruler.4
	title = magic_ruler.4.t
	desc = magic_ruler.4.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = enchantment_1
					has_ruler_flag = enchantment_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.10 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_enchantment
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_enchantment }
			OR = {
				has_ruler_flag = enchantment_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = enchantment_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Charm I - Estates
	option = {	#available
		name = magic_ruler.4.b
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 6
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 3
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 3
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 6
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.bx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 6
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#1 - Charm I - Diplomats
	option = {	#available
		name = magic_ruler.4.c
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.cx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#1 - Charm I - Military
	option = {	#available
		name = magic_ruler.4.dd
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ddx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#1 - Charm I - Subjects
	option = {	#available
		name = magic_ruler.4.e
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.em
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ex
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#2 - Charm II - Estates
	option = {	#available
		name = magic_ruler.4.f
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 12
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 6
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 6
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 12
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.fx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 12
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#2 - Charm II - Diplomats
	option = {	#available
		name = magic_ruler.4.g
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.gm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.gx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#2 - Charm II - Military
	option = {	#available
		name = magic_ruler.4.h
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.hm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.hx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#2 - Charm II - Subjects
	option = {	#available
		name = magic_ruler.4.i
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.im
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ix
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#2 - Modify Memories - Overlook Blunder
	option = {	#available
		name = magic_ruler.4.j
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_overlook_national_blunders
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_overlook_national_blunders
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_blunder_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.jm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_blunder_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.jx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_blunder_desc_tt
	}

	#2 - Modify Memories - Subservience
	option = {	#available
		name = magic_ruler.4.k
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_encourage_subservience
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_encourage_subservience
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_subservience_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.km
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_subservience_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.kx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_subservience_desc_tt
	}

	#2 - Modify Memories - Atrocities
	option = {	#available
		name = magic_ruler.4.l
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_forget_atrocities
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_forget_atrocities
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_atrocities_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.lm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_memories_atrocities_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.lx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_atrocities_desc_tt
	}

	#3 - Dominate to Surrender
	option = {
		name = magic_ruler.4.m	#available
		trigger = {
			has_ruler_flag = enchantment_3
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
			NOT = { ruler_has_personality = huangke_adm_personality }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					NOT = { adm_power = 20 }
					NOT = { dip_power = 20 }
				}
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.5 }
		if = {
			limit = { has_ruler_flag = baku_patron }
			custom_tooltip = magic_booster_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_instant_siege
				duration = 3
			}
		}
		custom_tooltip = magic_dominate_desc_tt
	}
	option = {
		name = magic_ruler.4.mm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_legendary_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_instant_siege
				duration = 3
			}
		}
		custom_tooltip = magic_dominate_desc_tt
	}
	option = {
		name = magic_ruler.4.mx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
				ruler_has_personality = huangke_adm_personality
			}
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}
		if = {
			limit = { ruler_has_personality = huangke_adm_personality }
			custom_tooltip = huangke_adm_personality_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_instant_siege
				duration = 3
			}
		}
		custom_tooltip = magic_dominate_desc_tt
	}

	#3 - Charm III - Estates
	option = {	#available
		name = magic_ruler.4.n
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 20
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 10
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 10
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.nm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 20
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.nx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 20
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#3 - Charm III - Diplomats
	option = {	#available
		name = magic_ruler.4.o
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.om
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ox
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#3 - Charm III - Military
	option = {	#available
		name = magic_ruler.4.p
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.pm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.px
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#3 - Charm III - Subjects
	option = {	#available
		name = magic_ruler.4.q
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.qm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.qx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Evocation - Menu
country_event = {
	id = magic_ruler.5
	title = magic_ruler.5.t
	desc = magic_ruler.5.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = evocation_1
					has_ruler_flag = evocation_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.13 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_evocation
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_evocation }
			OR = {
				has_ruler_flag = evocation_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = evocation_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - War magic I
	option = {	#available
		name = magic_ruler.5.b
		trigger = {
			has_ruler_flag = evocation_1
			mil_power = 50
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip =  magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_1
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_1
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_1 }
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_1
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.bx
		trigger = {
			ai = no
			has_ruler_flag = evocation_1
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_1
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#1 - #Fireball
	option = {
		name = magic_ruler.5.c	#available
		trigger = {
			has_ruler_flag = evocation_1
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { mil_power = 10 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.8 }
		if = {
			limit = {
				OR = {
					has_ruler_flag = rakshasa_patron
					has_ruler_flag = manifestation_of_surael_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {
			limit = { has_ruler_flag = autumn_gloam_patron }
			custom_tooltip = magic_booster_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}
	option = {
		name = magic_ruler.5.cm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_1 }
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_talented_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}
	option = {
		name = magic_ruler.5.cx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = evocation_1
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}

	#2 - War magic II
	option = {	#available
		name = magic_ruler.5.dd
		trigger = {
			has_ruler_flag = evocation_2
			mil_power = 50
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_2
				duration = 1825
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_2
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_2
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.ddx
		trigger = {
			ai = no
			has_ruler_flag = evocation_2
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_green_war_magic_1
					has_ruler_modifier = patron_green_war_magic_2
					has_ruler_modifier = patron_green_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_2
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#2 - #Earthquake
	option = {
		name = magic_ruler.5.e	#available
		trigger = {
			has_ruler_flag = evocation_2
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { adm_power = 20 }
				NOT = { mil_power = 5 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.11 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}
	option = {
		name = magic_ruler.5.em	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_2 }
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_renowned_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}
	option = {
		name = magic_ruler.5.ex	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = evocation_2
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}

	#3 - War magic III
	option = {	#available
		name = magic_ruler.5.f
		trigger = {
			has_ruler_flag = evocation_3
			mil_power = 50
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_3
				duration = 1825
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_3
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_3
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.fx
		trigger = {
			ai = no
			has_ruler_flag = evocation_3
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_green_war_magic_1
					has_ruler_modifier = patron_green_war_magic_2
					has_ruler_modifier = patron_green_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_3
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#3 - #Meteor Strike
	option = {
		name = magic_ruler.5.g	#available
		trigger = {
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
			NOT = { ruler_has_personality = huangke_adm_personality }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { mil_power = 50 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.14 }
		if = {
			limit = {
				has_ruler_flag = rakshasa_patron
				NOT = { has_ruler_flag = evocation_3 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
				NOT = { has_ruler_flag = evocation_3 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}
	option = {
		name = magic_ruler.5.gm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_legendary_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}
	option = {
		name = magic_ruler.5.gx	#unavailable - other
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
				ruler_has_personality = huangke_adm_personality
			}
			
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}
		if = {
			limit = { ruler_has_personality = huangke_adm_personality }
			custom_tooltip = huangke_adm_personality_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Necromancy - Menu
country_event = {
	id = magic_ruler.7
	title = magic_ruler.7.t
	desc = magic_ruler.7.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_in_capital_area = yes
				}
				save_event_target_as = undead_army_province
			}
			random_owned_province = {
				limit = {
					is_capital = yes
				}
				save_event_target_as = undead_army_province
			}
			random_owned_province = {
				limit = {
					has_ruler_leader_from = ROOT
				}
				save_event_target_as = undead_army_province
			}
		}
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = necromancy_3 }
			NOT = { ruler_studying_magic = yes }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = necromancy_1
					has_ruler_flag = necromancy_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		if = {
			limit = { tag = I20 has_reform = krakazol_olzonog }
			custom_tooltip = krakazol_no_necromancy_tooltip
			hidden_effect = { country_event = { id = flavor_krakazol.210 days = 30 random = 30 } }
		}
		country_event = { id = magic_study.19 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_necromancy
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_necromancy }
			OR = {
				has_ruler_flag = necromancy_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
				has_country_flag = necromancy_disallowed
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = necromancy_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		if = {
			limit = { ruler_has_personality = huangke_adm_personality }
			custom_tooltip = huangke_adm_personality_tt
		}
		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Absorb Life Energy
	option = {	#available
		name = magic_ruler.7.b
		trigger = {
			has_ruler_flag = necromancy_1
			adm_power = 5
			mil_power = 5
			NOT = { has_ruler_modifier = magic_drain_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 50
		}

		add_adm_power = -5
		add_mil_power = -5
		custom_tooltip = magic_absorb_life_effect_tt
		country_event = { id = magic_ruler.13 }

		custom_tooltip = magic_absorb_life_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -5
			add_mil_power = -5
		}
		custom_tooltip = magic_absorb_life_effect_tt

		custom_tooltip = magic_absorb_life_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.bx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_1
			OR = {
				NOT = { adm_power = 5 }
				NOT = { mil_power = 5 }
				has_ruler_modifier = magic_drain_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_drain_cooldown }
			custom_tooltip = magic_1_year_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 5 } }
			custom_tooltip = magic_need_5_adm_tt
		}
		if = { limit = { NOT = { mil_power = 5 } }
			custom_tooltip = magic_need_5_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -5
			add_mil_power = -5
		}
		custom_tooltip = magic_absorb_life_effect_tt

		custom_tooltip = magic_absorb_life_desc_tt
	}

	#2 - Summon Undead Army I
	option = {	#available
		name = magic_ruler.7.c
		trigger = {
			has_ruler_flag = necromancy_2
			NOT = { has_ruler_flag = necromancy_3 }
			adm_power = 15
			dip_power = 15
			mil_power = 15
			NOT = { has_ruler_modifier = magic_undead_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 4
				is_at_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = { has_ruler_modifier = witch_king_modifier }
			}
			modifier = {
				factor = 0
				OR = {
					ruler_has_personality = benevolent_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = charismatic_negotiator_personality
					army_size_percentage = 1
				}
			}
		}

		add_adm_power = -15
		add_dip_power = -15
		add_mil_power = -15
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_undead_cooldown duration = 30 hidden = yes }

		event_target:undead_army_province = {
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
		}

		increase_witch_king_points_massive = yes

		if = { limit = { NOT = { has_country_modifier = undead_military } }
			clear_racial_military = yes
			tooltip = { add_country_modifier = { name = undead_military duration = -1 } }
			add_country_modifier = { name = undead_military duration = -1 hidden = yes }
		}
		if = {
			limit = {
				NOT = { unit_type = tech_undead }
				has_any_racial_military = yes
			}
			change_unit_type = tech_undead
		}

		custom_tooltip = magic_undead_army_desc_tt

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_2 }
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.cx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_2
			NOT = { has_ruler_flag = necromancy_3 }
			OR = {
				NOT = { adm_power = 15 }
				NOT = { dip_power = 15 }
				NOT = { mil_power = 15 }
				has_ruler_modifier = magic_undead_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_undead_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 15 } }
			custom_tooltip = magic_need_15_adm_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}
		if = { limit = { NOT = { mil_power = 15 } }
			custom_tooltip = magic_need_15_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}

	#3 - Summon Undead Army II
	option = {	#available
		name = magic_ruler.7.dd
		trigger = {
			has_ruler_flag = necromancy_3
			adm_power = 15
			dip_power = 15
			mil_power = 15
			NOT = { has_ruler_modifier = magic_undead_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 4
				is_at_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = { has_ruler_modifier = witch_king_modifier }
			}
			modifier = {
				factor = 0
				OR = {
					ruler_has_personality = benevolent_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = charismatic_negotiator_personality
					army_size_percentage = 1
				}
			}
		}

		add_adm_power = -15
		add_dip_power = -15
		add_mil_power = -15
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_undead_cooldown duration = 30 hidden = yes }

		event_target:undead_army_province = {
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			cavalry = ROOT
			cavalry = ROOT
		}

		increase_witch_king_points_massive = yes

		if = { limit = { NOT = { has_country_modifier = undead_military } }
			clear_racial_military = yes
			tooltip = { add_country_modifier = { name = undead_military duration = -1 } }
			add_country_modifier = { name = undead_military duration = -1 hidden = yes }
		}
		if = {
			limit = {
				NOT = { unit_type = tech_undead }
				has_any_racial_military = yes
			}
			change_unit_type = tech_undead
		}

		custom_tooltip = magic_undead_army_desc_tt

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				cavalry = ROOT
				cavalry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.ddx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_3
			OR = {
				NOT = { adm_power = 15 }
				NOT = { dip_power = 15 }
				NOT = { mil_power = 15 }
				has_ruler_modifier = magic_undead_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_undead_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 15 } }
			custom_tooltip = magic_need_15_adm_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}
		if = { limit = { NOT = { mil_power = 15 } }
			custom_tooltip = magic_need_15_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				cavalry = ROOT
				cavalry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}

	#3 - Lichdom
	option = {	#available
		name = magic_ruler.7.e
		trigger = {
			has_ruler_flag = necromancy_3
			NOT = { magical_project_in_progress = yes }
			NOT = { has_ruler_flag = is_a_vampire }
			NOT = { has_ruler_flag = is_a_lich }
			NOT = { has_ruler_flag = xhazob_patron }
			adm_power = 300
			dip_power = 300
			mil_power = 300
			is_lesser_in_union = no
			NOT = { has_country_flag = gemradcurt_immariel_rules }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				ruler_age = 40
				culture_is_short_lived = yes
			}
			modifier = {
				factor = 0.25
				NOT = { culture_is_short_lived = yes }
			}
		}

		increase_witch_king_points_large = yes
		add_adm_power = -300
		add_dip_power = -300
		add_mil_power = -300
		magic_casted_spell = yes
		set_ruler_flag = magic_project_lichdom_started
		custom_tooltip = tooltip_magic_project_start
		hidden_effect = { country_event = { id = magic_project_lichdom.1 days = 90 } }

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_lichdom_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.em
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_large = yes
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_lichdom_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.7.ex
		trigger = {
			ai = no
			has_ruler_flag = necromancy_3
			OR = {
				has_ruler_flag = is_a_vampire
				has_ruler_flag = is_a_lich
				magical_project_in_progress = yes
				NOT = { adm_power = 300 }
				NOT = { dip_power = 300 }
				NOT = { mil_power = 300 }
				is_lesser_in_union = yes
				has_country_flag = gemradcurt_immariel_rules
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_flag = is_a_lich }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_lichdom_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			else_if = { limit = { has_ruler_flag = is_a_vampire }
                custom_tooltip = magic_vampires_cant_be_liches_tt
            }
            else_if = { limit = { has_country_flag = gemradcurt_immariel_rules }
                custom_tooltip = immariel_cant_into_lich_tt
            }
			if = { limit = { is_lesser_in_union = yes }
				custom_tooltip = magic_is_not_in_lesser_union_tt
			}
			if = { limit = { NOT = { adm_power = 300 } }
				custom_tooltip = magic_need_300_adm_tt
			}
			if = { limit = { NOT = { dip_power = 300 } }
				custom_tooltip = magic_need_300_dip_tt
			}
			if = { limit = { NOT = { mil_power = 300 } }
				custom_tooltip = magic_need_300_mil_tt
			}
			if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
				custom_tooltip = varamhar_unable_to_perform_necromancy_tt
			}
			if = { limit = { has_country_flag = necromancy_disallowed }
				custom_tooltip = tooltip_unable_to_perform_necromancy
			}
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_large = yes
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_lichdom_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}